---
title: 139, 445 - SMB
position: 139
badge: 139,445/TCP
---


## Credentials

### Possible default credentials

| **Username(s)**      | **Common passwords**                      |
| -------------------- | ----------------------------------------- |
| _(blank)_            | _(blank)_                                 |
| guest                | _(blank)_                                 |
| Administrator, admin | _(blank)_, password, administrator, admin |
| arcserve             | arcserve, backup                          |
| tivoli, tmersrvd     | tivoli, tmersrvd, admin                   |
| backupexec, backup   | backupexec, backup, arcada                |
| test, lab, demo      | password, test, lab, demo                 |

```txt
:
guest:
Administrator:
Administrator:password
Administrator:administrator
Administrator:admin
admin:
admin:password
admin:administrator
admin:admin
arcserve:arcserve
arcserve:backup
tivoli:tivoli
tivoli:backup
tivoli:admin
tmersrvd:tivoli
tmersrvd:backup
tmersrvd:admin
backupexec:backupexec
backupexec:backup
backupexec:arcada
backup:backupexec
backup:backup
backup:arcada
test:password
test:test
test:lab
test:demo
lab:password
lab:test
lab:lab
lab:demo
demo:password
demo:test
demo:lab
demo:demo
```

## Enumeration

### Enumerating LSARPC and SAMR `rpcclient`

You can connect with the `rpcclient` command included with Samba.

Test your connection with the following:

<smart-tabs variable="ad-auth-method" :tabs="{'anon': 'No credentials', 'pw': 'With password', 'hash':'With hash'}">
<template v-slot:anon>

```shell
rpcclient -U "" -N {{ rhost 10.10.10.16 }}
```

</template>
<template v-slot:pw>

```shell
rpcclient -U "{{ domain domain.local }}/{{ username username }}%{{ password password }}" {{ rhost 10.10.10.16 }}
```

</template>
<template v-slot:hash>

```shell
rpcclient -U "{{ domain domain.local }}/{{ username username }}%{{ nt-hash BE0583D5F18A8679D304AAFEF0A888C6 }}" --pw-nt-hash {{ rhost //htb.local }}
```

</template>
</smart-tabs>

#### Useful commands

If the connection succeeds you can run commands either via the interactive prompt or with the `-c` flag:

```shell
{{ rpcclient-command rpcclient -U "" -N 10.10.10.16 }} -c "{{ command querydispinfo }}"
```

You can execute multiple commands using semicolon `;`. For example: `querydisplinfo;getdomusers`

##### **Available commands**

- **Users**
  - **List users**: `querydispinfo` (You might find password on user's descriptions) and `enumdomusers`
  - **Get user details**: `queryuser <0xrid>`
  - **Get user groups**: `queryusergroups <0xrid>`
  - **GET SID of a user**: `lookupnames <username>`
  - **Get users aliases**: `queryuseraliases [builtin|domain] <sid>`
  - **Examples**:
    - Enumerate valid usernames:

```shell
{{ rpcclient-command rpcclient -U "" -N 10.10.10.16 }} -c "enumdomusers" | grep -oP '\[\K[^]]+' | grep -v '0x[0-9abcdef]\{3\}'
```

- **Groups**
  - **List groups**: `enumdomgroups`
  - **Get group details**: `querygroup <0xrid>`
  - **Get group members**: `querygroupmem <0xrid>`

- **Domains**
  - **List domains**: `enumdomains`
  - **Get SID**: `lsaquery`
  - **Domain info**: `querydominfo`

- **More**

  - **Find SIDs by name**: `lookupnames <username>`
  - **Find more SIDs**: `lsaenumsid`
  - **RID cycling (check more SIDs)**: `lookupsids <sid>`

| **Command**         | **Interface**                                                                                                                                     | **Description**                                                                                                                           |
| ------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------- |
| `queryuser`           | SAMR                                                                                                                                              | Retrieve user information                                                                                                                 |
| `querygroup`          | Retrieve group information                                                                                                                        |                                                                                                                                           |
| `querydominfo`        | Retrieve domain information                                                                                                                       |                                                                                                                                           |
| `enumdomusers`        | Enumerate domain users                                                                                                                            |                                                                                                                                           |
| `enumdomgroups`       | Enumerate domain groups                                                                                                                           |                                                                                                                                           |
| `createdomuser`       | Create a domain user                                                                                                                              |                                                                                                                                           |
| `deletedomuser`       | Delete a domain user                                                                                                                              |                                                                                                                                           |
| `lookupnames`         | LSARPC                                                                                                                                            | Look up usernames to SID[a](https://learning.oreilly.com/library/view/network-security-assessment/9781491911044/ch08.html#ch08fn8) values |
| `lookupsids`          | Look up SIDs to usernames (RID[b](https://learning.oreilly.com/library/view/network-security-assessment/9781491911044/ch08.html#ch08fn9) cycling) |                                                                                                                                           |
| `lsaaddacctrights`    | Add rights to a user account                                                                                                                      |                                                                                                                                           |
| `lsaremoveacctrights` | Remove rights from a user account                                                                                                                 |                                                                                                                                           |
| `dsroledominfo`       | LSARPC-DS                                                                                                                                         | Get primary domain information                                                                                                            |
| `dsenumdomtrusts`     | Enumerate trusted domains within an AD forest                                                                                                     |                                                                                                                                           |

## PWN

### With `crackmapexec`

Very useful tool. I usually check connection with:

<smart-tabs variable="ad-auth-method" :tabs="{'anon': 'No credentials', 'pw': 'With password', 'hash':'With hash'}">
<template v-slot:anon>

```shell
crackmapexec smb {{ rhost 10.10.10.16 }} --shares
```

</template>
<template v-slot:pw>

```shell
crackmapexec smb {{ rhost 10.10.10.16 }} -u '{{ username username }}' -p '{{ password securePassword!!.. }}'
```

</template>
<template v-slot:hash>

```shell
crackmapexec smb {{ rhost 10.10.10.16 }} -u '{{ username username }}' -H '{{ nt-hash BE0583D5F18A8679D304AAFEF0A888C6 }}'
```

</template>
</smart-tabs>
